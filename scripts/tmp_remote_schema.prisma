generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("NETLIFY_DATABASE_URL")
}

model User {
  id                        String                  @id @default(cuid())
  email                     String                  @unique
  name                      String?
  password                  String?
  image                     String?
  role                      UserRole                @default(CLIENT)
  emailVerified             DateTime?
  createdAt                 DateTime                @default(now())
  updatedAt                 DateTime                @updatedAt
  sessionVersion            Int                     @default(0)
  availabilityStatus        AvailabilityStatus      @default(AVAILABLE)
  department                String?
  employeeId                String?                 @unique
  expertiseLevel            ExpertiseLevel?
  hireDate                  DateTime?
  hourlyRate                Decimal?
  managerId                 String?
  maxConcurrentProjects     Int?                    @default(3)
  position                  String?
  skills                    String[]
  tenantId                  String
  bookingPreferences        BookingPreferences?
  assignedByServiceRequests ServiceRequest[]        @relation("ServiceRequestAssignedBy")
  clientServiceRequests     ServiceRequest[]        @relation("ServiceRequestClient")
  tasks                     Task[]
  taskComments              TaskComment[]
  assignedWorkOrders        WorkOrder[]             @relation("WorkOrderAssignee")
  workOrdersAsClient        WorkOrder[]             @relation("WorkOrderClient")
  accounts                  Account[]
  attachments               attachments[]
  bookings                  Booking[]
  expenses                  Expense[]
  invoices                  Invoice[]
  posts                     Post[]
  serviceRequestComments    ServiceRequestComment[]
  sessions                  Session[]
  taskTemplates             TaskTemplate[]
  teamMembers               TeamMember[]            @relation("UserTeamMember")
  grantedPermissions        UserPermission[]        @relation("GrantedBy")
  userPermissions           UserPermission[]        @relation("UserPermissions")
  manager                   User?                   @relation("ManagerEmployee", fields: [managerId], references: [id])
  employees                 User[]                  @relation("ManagerEmployee")
  tenant                    Tenant                  @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "users_tenantid_fkey")

  @@index([createdAt])
  @@index([email])
  @@index([role])
  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verificationtokens")
}

model Tenant {
  id                    String                 @id @default(cuid())
  slug                  String                 @unique
  name                  String
  status                String?                @default("ACTIVE")
  primarydomain         String?                @unique
  description           String?
  featureflags          Json?
  metadata              Json?
  createdAt             DateTime?              @default(now()) @db.Timestamptz(6)
  updatedAt             DateTime?              @default(now()) @updatedAt @db.Timestamptz(6)
  primaryDomain         String?                @unique(map: "tenant_primarydomain_unique")
  featureFlags          Json?
  idempotencyKeys       IdempotencyKey[]
  scheduledReminders    ScheduledReminder[]
  workOrders            WorkOrder[]
  attachments           attachments[]
  bookings              Booking[]
  chatMessages          ChatMessage[]
  communicationSettings CommunicationSettings?
  expenses              Expense[]
  integrationSettings   IntegrationSettings?
  invoices              Invoice[]
  organizationSettings  OrganizationSettings?
  securitySettings      SecuritySettings?
  users                 User[]
}

model Post {
  id             String       @id @default(cuid())
  title          String
  slug           String       @unique
  content        String
  excerpt        String?
  published      Boolean      @default(false)
  featured       Boolean      @default(false)
  coverImage     String?
  seoTitle       String?
  seoDescription String?
  tags           String[]
  readTime       Int?
  views          Int          @default(0)
  authorId       String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  publishedAt    DateTime?
  approvedBy     String?
  archived       Boolean      @default(false)
  category       String?
  comments       Int          @default(0)
  isCompliant    Boolean      @default(true)
  priority       PostPriority @default(MEDIUM)
  reviewRequired Boolean      @default(false)
  scheduledAt    DateTime?
  shares         Int          @default(0)
  status         PostStatus   @default(DRAFT)
  version        Int          @default(1)
  author         User         @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([publishedAt])
  @@index([featured])
  @@map("posts")
}

model Newsletter {
  id         String   @id @default(cuid())
  email      String   @unique
  name       String?
  subscribed Boolean  @default(true)
  source     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("newsletter")
}

model NotificationSettings {
  id           String   @id @default(cuid())
  emailEnabled Boolean  @default(false)
  emailFrom    String?
  webhookUrl   String?
  templates    Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("notification_settings")
}

model Service {
  id                     String             @id @default(cuid())
  name                   String
  slug                   String
  description            String
  shortDesc              String?
  features               String[]
  price                  Decimal?
  duration               Int?
  category               String?
  active                 Boolean            @default(true)
  featured               Boolean            @default(false)
  image                  String?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt
  basePrice              Decimal?
  estimatedDurationHours Int?
  requiredSkills         String[]
  status                 ServiceStatus      @default(ACTIVE)
  tenantId               String?
  bookingEnabled         Boolean            @default(true)
  advanceBookingDays     Int                @default(30)
  minAdvanceHours        Int                @default(24)
  maxDailyBookings       Int?
  bufferTime             Int                @default(0)
  businessHours          Json?
  blackoutDates          DateTime[]
  views                  Int                @default(0)
  serviceSettings        Json?
  availabilitySlots      AvailabilitySlot[]
  serviceRequests        ServiceRequest[]
  workOrders             WorkOrder[]
  bookings               Booking[]
  serviceViews           ServiceView[]

  @@unique([tenantId, slug])
  @@index([tenantId])
  @@index([active, bookingEnabled])
  @@index([status])
  @@index([createdAt])
  @@index([updatedAt])
  @@index([active, featured])
  @@map("services")
}

model ServiceView {
  id        String   @id @default(cuid())
  serviceId String   @map("service_id")
  tenantId  String?  @map("tenant_id")
  ip        String?
  userAgent String?  @map("user_agent")
  createdAt DateTime @default(now()) @map("created_at")
  service   Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([serviceId, createdAt])
  @@map("service_views")
}

model Booking {
  id                   String          @id @default(cuid())
  clientId             String
  serviceId            String
  status               BookingStatus   @default(PENDING)
  scheduledAt          DateTime
  duration             Int
  notes                String?
  clientName           String
  clientEmail          String
  clientPhone          String?
  adminNotes           String?
  confirmed            Boolean         @default(false)
  reminderSent         Boolean         @default(false)
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  assignedTeamMemberId String?
  serviceRequestId     String?
  tenantId             String
  workOrders           WorkOrder[]
  assignedTeamMember   TeamMember?     @relation(fields: [assignedTeamMemberId], references: [id])
  client               User            @relation(fields: [clientId], references: [id], onDelete: Cascade)
  service              Service         @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceRequest       ServiceRequest? @relation(fields: [serviceRequestId], references: [id])
  tenant               Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  invoices             Invoice[]

  @@index([scheduledAt])
  @@index([status])
  @@index([clientId])
  @@index([serviceId])
  @@index([clientEmail])
  @@index([createdAt])
  @@index([status, scheduledAt])
  @@index([tenantId])
  @@index([tenantId], map: "bookings_tenantid_idx")
  @@map("bookings")
}

model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  company   String?
  subject   String?
  message   String
  source    String?
  responded Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([responded, createdAt])
  @@index([createdAt])
  @@map("contact_submissions")
}

model HealthLog {
  id        String   @id @default(cuid())
  service   String
  status    String
  message   String?
  checkedAt DateTime @default(now())

  @@index([checkedAt])
  @@index([service, checkedAt])
  @@index([service, status, checkedAt])
}

model HealthThreshold {
  id            Int      @id @default(autoincrement())
  responseTime  Int      @default(100)
  errorRate     Float    @default(1.0)
  storageGrowth Float    @default(20.0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Currency {
  code      String          @id
  name      String
  symbol    String?
  decimals  Int             @default(2)
  active    Boolean         @default(false)
  isDefault Boolean         @default(false)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  rates     ExchangeRate[]
  overrides PriceOverride[]
}

model ExchangeRate {
  id         Int      @id @default(autoincrement())
  base       String
  target     String
  rate       Float
  source     String?
  fetchedAt  DateTime @default(now())
  ttlSeconds Int?
  currency   Currency @relation(fields: [target], references: [code])

  @@index([base, target])
}

model PriceOverride {
  id           Int      @id @default(autoincrement())
  entity       String
  entityId     String
  currencyCode String
  priceCents   Int
  note         String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  currency     Currency @relation(fields: [currencyCode], references: [code])

  @@index([entity, entityId, currencyCode])
}

model Task {
  id                 String             @id @default(cuid())
  title              String
  dueAt              DateTime?
  priority           TaskPriority       @default(MEDIUM)
  status             TaskStatus         @default(OPEN)
  assigneeId         String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  complianceDeadline DateTime?
  complianceRequired Boolean            @default(false)
  description        String?
  complianceRecords  ComplianceRecord[]
  assignee           User?              @relation(fields: [assigneeId], references: [id])
  comments           TaskComment[]
  requestTasks       RequestTask[]

  @@index([assigneeId])
  @@index([createdAt])
  @@index([dueAt])
  @@index([status, dueAt])
  @@index([status])
}

model ComplianceRecord {
  id          String    @id @default(cuid())
  taskId      String
  type        String
  status      String
  dueAt       DateTime?
  completedAt DateTime?
  riskScore   Int?
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  task        Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
}

model TaskComment {
  id          String        @id @default(cuid())
  taskId      String
  authorId    String?
  parentId    String?
  content     String
  attachments Json?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  author      User?         @relation(fields: [authorId], references: [id])
  parent      TaskComment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies     TaskComment[] @relation("CommentReplies")
  task        Task          @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
}

model TaskTemplate {
  id                  String       @id @default(cuid())
  name                String
  content             String
  createdById         String?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  category            String?
  checklistItems      String[]
  defaultAssigneeRole String?
  defaultCategory     String?
  defaultPriority     TaskPriority @default(MEDIUM)
  description         String?
  estimatedHours      Int?
  requiredSkills      String[]
  createdBy           User?        @relation(fields: [createdById], references: [id])

  @@index([category])
  @@map("task_templates")
}

model ServiceRequest {
  id                   String                  @id @default(cuid())
  title                String                  @db.VarChar(300)
  description          String?
  requirements         Json?
  attachments          Json?
  uuid                 String                  @unique @default(uuid())
  isBooking            Boolean                 @default(false)
  scheduledAt          DateTime?
  duration             Int?
  clientName           String?
  clientEmail          String?
  clientPhone          String?
  confirmed            Boolean                 @default(false)
  reminderSent         Boolean                 @default(false)
  recurringPattern     Json?
  parentBookingId      String?
  clientId             String
  serviceId            String
  budgetMin            Decimal?
  budgetMax            Decimal?
  deadline             DateTime?
  assignedTeamMemberId String?
  assignedAt           DateTime?
  assignedBy           String?
  completedAt          DateTime?
  clientApprovalAt     DateTime?
  createdAt            DateTime                @default(now())
  updatedAt            DateTime                @updatedAt
  tenantId             String
  paymentStatus        PaymentStatus?
  paymentProvider      String?
  paymentSessionId     String?                 @unique
  paymentAmountCents   Int?
  paymentCurrency      String?
  paymentUpdatedAt     DateTime?
  paymentAttempts      Int?                    @default(0)
  priority             RequestPriority         @default(MEDIUM)
  status               RequestStatus           @default(DRAFT)
  bookingType          BookingType?
  scheduledReminders   ScheduledReminder[]
  assignedByUser       User?                   @relation("ServiceRequestAssignedBy", fields: [assignedBy], references: [id])
  assignedTeamMember   TeamMember?             @relation(fields: [assignedTeamMemberId], references: [id])
  client               User                    @relation("ServiceRequestClient", fields: [clientId], references: [id], onDelete: Cascade)
  parentBooking        ServiceRequest?         @relation("RecurringBookings", fields: [parentBookingId], references: [id])
  childBookings        ServiceRequest[]        @relation("RecurringBookings")
  service              Service                 @relation(fields: [serviceId], references: [id])
  workOrders           WorkOrder[]
  attachments          attachments[]
  linkedBookings       Booking[]
  requestTasks         RequestTask[]
  comments             ServiceRequestComment[]

  @@index([clientId])
  @@index([scheduledAt])
  @@index([isBooking, status])
  @@index([tenantId])
  @@index([tenantId, status])
  @@index([tenantId, assignedTeamMemberId])
  @@index([tenantId, scheduledAt])
  @@index([tenantId, isBooking, status])
  @@index([tenantId], map: "servicerequest_tenantid_idx")
}

model RequestTask {
  id               String         @id @default(cuid())
  serviceRequestId String
  taskId           String
  createdAt        DateTime       @default(now())
  serviceRequest   ServiceRequest @relation(fields: [serviceRequestId], references: [id], onDelete: Cascade)
  task             Task           @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([serviceRequestId, taskId], name: "unique_request_task")
  @@map("request_tasks")
}

model TeamMember {
  id                      String             @id @default(cuid())
  userId                  String?
  name                    String
  email                   String?
  department              String?
  title                   String?
  status                  String?            @default("active")
  hourlyRate              Decimal?
  specialties             String[]
  workingHours            Json?
  isAvailable             Boolean            @default(true)
  timeZone                String?            @default("UTC")
  maxConcurrentBookings   Int                @default(3)
  bookingBuffer           Int                @default(15)
  autoAssign              Boolean            @default(true)
  stats                   Json?
  createdAt               DateTime           @default(now())
  updatedAt               DateTime           @updatedAt
  role                    UserRole?          @default(TEAM_MEMBER)
  availabilitySlots       AvailabilitySlot[]
  assignedServiceRequests ServiceRequest[]
  bookings                Booking[]
  user                    User?              @relation("UserTeamMember", fields: [userId], references: [id])

  @@index([isAvailable])
  @@index([status])
  @@map("team_members")
}

model ServiceRequestComment {
  id               String         @id @default(cuid())
  serviceRequestId String
  authorId         String?
  content          String
  attachments      Json?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  author           User?          @relation(fields: [authorId], references: [id])
  serviceRequest   ServiceRequest @relation(fields: [serviceRequestId], references: [id], onDelete: Cascade)

  @@map("service_request_comments")
}

model UserPermission {
  id          String   @id @default(cuid())
  userId      String
  grantedById String?
  permission  String
  scope       String?
  createdAt   DateTime @default(now())
  grantedBy   User?    @relation("GrantedBy", fields: [grantedById], references: [id])
  user        User     @relation("UserPermissions", fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_permissions")
}

model AvailabilitySlot {
  id              String      @id @default(cuid())
  date            DateTime
  available       Boolean     @default(true)
  reason          String?
  currentBookings Int         @default(0)
  endTime         String
  maxBookings     Int         @default(1)
  serviceId       String
  startTime       String
  teamMemberId    String?
  service         Service     @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  teamMember      TeamMember? @relation(fields: [teamMemberId], references: [id])

  @@unique([serviceId, teamMemberId, date, startTime])
  @@index([date, serviceId])
  @@index([teamMemberId, date])
  @@index([available, date])
}

model BookingPreferences {
  id                String   @id @default(cuid())
  createdAt         DateTime @default(now())
  emailCancellation Boolean  @default(true)
  emailConfirmation Boolean  @default(true)
  emailReminder     Boolean  @default(true)
  emailReschedule   Boolean  @default(true)
  preferredLanguage String   @default("en")
  reminderHours     Int[]    @default([24, 2])
  smsConfirmation   Boolean  @default(false)
  smsReminder       Boolean  @default(false)
  timeZone          String   @default("UTC")
  updatedAt         DateTime @updatedAt
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ScheduledReminder {
  id               String         @id @default(cuid())
  serviceRequestId String
  scheduledAt      DateTime
  channel          String         @default("EMAIL")
  sent             Boolean        @default(false)
  createdAt        DateTime       @default(now())
  tenantId         String
  serviceRequest   ServiceRequest @relation(fields: [serviceRequestId], references: [id], onDelete: Cascade)
  tenant           Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "scheduledreminder_tenantid_fkey")

  @@index([scheduledAt])
  @@index([serviceRequestId])
  @@index([tenantId], map: "scheduledreminder_tenantid_idx")
}

model WorkOrder {
  id               String          @id @default(cuid())
  tenantId         String
  title            String
  description      String?
  status           WorkOrderStatus @default(OPEN)
  priority         RequestPriority @default(MEDIUM)
  code             String?         @unique
  clientId         String?
  serviceId        String?
  serviceRequestId String?
  bookingId        String?
  assigneeId       String?
  dueAt            DateTime?
  startedAt        DateTime?
  completedAt      DateTime?
  estimatedHours   Int?
  actualHours      Int?
  costCents        Int?
  currency         String?
  tags             String[]
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  assignee         User?           @relation("WorkOrderAssignee", fields: [assigneeId], references: [id])
  booking          Booking?        @relation(fields: [bookingId], references: [id])
  client           User?           @relation("WorkOrderClient", fields: [clientId], references: [id])
  service          Service?        @relation(fields: [serviceId], references: [id])
  serviceRequest   ServiceRequest? @relation(fields: [serviceRequestId], references: [id])
  tenant           Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "workorder_tenantid_fkey")

  @@index([tenantId])
  @@index([status, priority])
  @@index([assigneeId])
  @@index([dueAt])
  @@index([createdAt])
  @@index([tenantId], map: "workorder_tenantid_idx")
}

model BookingSettings {
  id                        String                 @id @default(cuid())
  tenantId                  String                 @unique
  bookingEnabled            Boolean                @default(true)
  requireApproval           Boolean                @default(false)
  allowCancellation         Boolean                @default(true)
  allowRescheduling         Boolean                @default(true)
  cancellationDeadlineHours Int                    @default(24)
  rescheduleDeadlineHours   Int                    @default(4)
  paymentRequired           Boolean                @default(false)
  acceptCash                Boolean                @default(true)
  acceptCard                Boolean                @default(true)
  acceptBankTransfer        Boolean                @default(false)
  acceptWire                Boolean                @default(false)
  acceptCrypto              Boolean                @default(false)
  requireFullPayment        Boolean                @default(false)
  allowPartialPayment       Boolean                @default(true)
  depositPercentage         Int                    @default(50)
  enableServiceSelection    Boolean                @default(true)
  enableDateTimeSelection   Boolean                @default(true)
  enableCustomerDetails     Boolean                @default(true)
  enableAdditionalServices  Boolean                @default(true)
  enablePaymentStep         Boolean                @default(false)
  enableConfirmationStep    Boolean                @default(true)
  enableFileUpload          Boolean                @default(false)
  enableSpecialRequests     Boolean                @default(true)
  advanceBookingDays        Int                    @default(365)
  minAdvanceBookingHours    Int                    @default(2)
  maxBookingsPerDay         Int                    @default(50)
  maxBookingsPerCustomer    Int                    @default(5)
  bufferTimeBetweenBookings Int                    @default(15)
  businessHours             Json?
  blackoutDates             Json?
  holidaySchedule           Json?
  sendBookingConfirmation   Boolean                @default(true)
  sendReminders             Boolean                @default(true)
  reminderHours             Json?
  notifyTeamMembers         Boolean                @default(true)
  emailNotifications        Boolean                @default(true)
  smsNotifications          Boolean                @default(false)
  requireLogin              Boolean                @default(false)
  allowGuestBooking         Boolean                @default(true)
  showPricing               Boolean                @default(true)
  showTeamMemberSelection   Boolean                @default(false)
  allowRecurringBookings    Boolean                @default(false)
  enableWaitlist            Boolean                @default(false)
  enableAutoAssignment      Boolean                @default(false)
  assignmentStrategy        String                 @default("ROUND_ROBIN")
  considerWorkload          Boolean                @default(true)
  considerSpecialization    Boolean                @default(true)
  enableDynamicPricing      Boolean                @default(false)
  peakHoursSurcharge        Decimal                @default(0.0)
  weekendSurcharge          Decimal                @default(0.0)
  emergencyBookingSurcharge Decimal                @default(0.5)
  calendarSync              Boolean                @default(false)
  webhookUrl                String?
  apiAccessEnabled          Boolean                @default(false)
  createdAt                 DateTime               @default(now())
  updatedAt                 DateTime               @updatedAt
  updatedBy                 String?
  automation                Json?
  capacity                  Json?
  forms                     Json?
  integrations              Json?
  steps                     BookingStepConfig[]
  businessHoursConfig       BusinessHoursConfig[]
  notificationTemplates     NotificationTemplate[]
  paymentMethods            PaymentMethodConfig[]

  @@index([tenantId])
  @@map("booking_settings")
}

model BookingStepConfig {
  id                String          @id @default(cuid())
  bookingSettingsId String
  stepName          String
  stepOrder         Int
  enabled           Boolean         @default(true)
  required          Boolean         @default(true)
  title             String
  description       String?
  validationRules   Json?
  customFields      Json?
  createdAt         DateTime        @default(now())
  settings          BookingSettings @relation(fields: [bookingSettingsId], references: [id], onDelete: Cascade)

  @@index([bookingSettingsId, stepOrder])
  @@map("booking_step_config")
}

model BusinessHoursConfig {
  id                 String          @id @default(cuid())
  bookingSettingsId  String
  dayOfWeek          Int
  isWorkingDay       Boolean         @default(true)
  startTime          String?
  endTime            String?
  breakStartTime     String?
  breakEndTime       String?
  maxBookingsPerHour Int             @default(4)
  settings           BookingSettings @relation(fields: [bookingSettingsId], references: [id], onDelete: Cascade)

  @@index([bookingSettingsId, dayOfWeek])
  @@map("business_hours_config")
}

model PaymentMethodConfig {
  id                String          @id @default(cuid())
  bookingSettingsId String
  methodType        String
  enabled           Boolean         @default(true)
  displayName       String
  description       String?
  processingFee     Decimal         @default(0.0)
  minAmount         Decimal         @default(0.0)
  maxAmount         Decimal?
  gatewayConfig     Json?
  settings          BookingSettings @relation(fields: [bookingSettingsId], references: [id], onDelete: Cascade)

  @@unique([bookingSettingsId, methodType])
  @@map("payment_method_config")
}

model NotificationTemplate {
  id                String          @id @default(cuid())
  bookingSettingsId String
  templateType      String
  channel           String
  enabled           Boolean         @default(true)
  subject           String?
  content           String
  variables         Json?
  settings          BookingSettings @relation(fields: [bookingSettingsId], references: [id], onDelete: Cascade)

  @@index([bookingSettingsId, templateType])
  @@map("notification_templates")
}

model Invoice {
  id         String        @id @default(cuid())
  tenantId   String
  bookingId  String?
  clientId   String?
  number     String?       @unique
  status     InvoiceStatus @default(UNPAID)
  currency   String        @default("USD")
  totalCents Int           @default(0)
  paidAt     DateTime?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  items      InvoiceItem[]
  booking    Booking?      @relation(fields: [bookingId], references: [id])
  client     User?         @relation(fields: [clientId], references: [id])
  tenant     Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "invoices_tenantid_fkey")

  @@index([tenantId])
  @@index([bookingId])
  @@index([clientId])
  @@map("invoices")
}

model InvoiceItem {
  id             String  @id @default(cuid())
  invoiceId      String
  description    String
  quantity       Int     @default(1)
  unitPriceCents Int     @default(0)
  totalCents     Int     @default(0)
  invoice        Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
  @@map("invoice_items")
}

model Expense {
  id           String       @id @default(cuid())
  tenantId     String
  vendor       String
  category     String?
  status       String       @default("PENDING")
  amountCents  Int
  currency     String       @default("USD")
  date         DateTime
  attachmentId String?
  userId       String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  attachment   attachments? @relation(fields: [attachmentId], references: [id])
  tenant       Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "expenses_tenantid_fkey")
  user         User?        @relation(fields: [userId], references: [id])

  @@index([tenantId])
  @@index([date])
  @@index([status])
  @@map("expenses")
}

model ChatMessage {
  id        String   @id @default(cuid())
  tenantId  String
  room      String?
  userId    String
  userName  String
  role      String
  text      String
  createdAt DateTime @default(now())
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tenantId, room, createdAt])
  @@map("chat_messages")
}

model IdempotencyKey {
  id         Int       @id @default(autoincrement())
  key        String    @unique
  userId     String?
  tenantId   String
  entityType String?
  entityId   String?
  status     String    @default("RESERVED")
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  expiresAt  DateTime?
  tenant     Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "idempotencykey_tenantid_fkey")

  @@unique([tenantId, key], map: "IdempotencyKey_tenantId_key_unique")
  @@index([tenantId])
  @@index([tenantId], map: "idempotencykey_tenantid_idx")
}

model OrganizationSettings {
  id              String   @id @default(cuid())
  tenantId        String   @unique
  name            String
  logoUrl         String?
  tagline         String?
  description     String?
  industry        String?
  contactEmail    String?
  contactPhone    String?
  address         Json?
  defaultTimezone String?  @default("UTC")
  defaultCurrency String?  @default("USD")
  defaultLocale   String?  @default("en")
  branding        Json?
  legalLinks      Json?
  termsUrl        String?
  privacyUrl      String?
  refundUrl       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@map("organization_settings")
}

model IntegrationSettings {
  id        String   @id @default(cuid())
  tenantId  String   @unique
  payments  Json?
  calendars Json?
  comms     Json?
  analytics Json?
  storage   Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@map("integration_settings")
}

model CommunicationSettings {
  id            String   @id @default(cuid())
  tenantId      String   @unique
  email         Json?
  sms           Json?
  chat          Json?
  notifications Json?
  newsletters   Json?
  reminders     Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  tenant        Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@map("communication_settings")
}

model SecuritySettings {
  id              String   @id @default(cuid())
  tenantId        String   @unique
  passwordPolicy  Json?
  sessionSecurity Json?
  twoFactor       Json?
  network         Json?
  dataProtection  Json?
  compliance      Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  superAdmin      Json?
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@map("security_settings")
}

model attachments {
  id               String          @id(map: "Attachment_pkey")
  key              String?         @unique(map: "Attachment_key_key")
  url              String?
  name             String?
  size             Int?
  contentType      String?
  avStatus         String?
  avDetails        Json?
  avScanAt         DateTime?
  avThreatName     String?
  avScanTime       Float?
  provider         String?
  uploadedAt       DateTime        @default(now())
  uploaderId       String?
  serviceRequestId String?
  tenantId         String
  ServiceRequest   ServiceRequest? @relation(fields: [serviceRequestId], references: [id], onDelete: Cascade, map: "Attachment_serviceRequestId_fkey")
  users            User?           @relation(fields: [uploaderId], references: [id], map: "Attachment_uploaderId_fkey")
  Tenant           Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "attachment_tenantId_fkey")
  expenses         Expense[]

  @@index([serviceRequestId], map: "Attachment_serviceRequestId_idx")
  @@index([tenantId], map: "Attachment_tenantId_idx")
  @@index([tenantId], map: "attachments_tenantid_idx")
  @@index([tenantId], map: "idx_attachment_tenant")
}

model playing_with_neon {
  id    Int    @id @default(autoincrement())
  name  String
  value Float? @db.Real
}

enum TenantStatus {
  ACTIVE
  SUSPENDED
  DECOMMISSIONED
}

enum InvoiceStatus {
  DRAFT
  SENT
  UNPAID
  PAID
  VOID
}

enum ExpertiseLevel {
  junior
  mid
  senior
  lead
  expert
}

enum AvailabilityStatus {
  AVAILABLE
  BUSY
  OFFLINE
  ON_LEAVE
}

enum ServiceStatus {
  ACTIVE
  INACTIVE
  DEPRECATED
  DRAFT
  RETIRED
}

enum RequestPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum RequestStatus {
  DRAFT
  SUBMITTED
  IN_REVIEW
  APPROVED
  ASSIGNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum DefaultRole {
  TEAM_MEMBER
  TEAM_LEAD
  ADMIN
}

enum PostStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
  ARCHIVED
}

enum PostPriority {
  LOW
  MEDIUM
  HIGH
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
}

enum TaskStatus {
  OPEN
  IN_PROGRESS
  REVIEW
  COMPLETED
  BLOCKED
}

enum PaymentStatus {
  UNPAID
  PAID
  FAILED
  REFUNDED
  PARTIAL
}

enum WorkOrderStatus {
  DRAFT
  OPEN
  IN_PROGRESS
  ON_HOLD
  BLOCKED
  APPROVAL_PENDING
  COMPLETED
  CANCELLED
}

enum BookingType {
  STANDARD
  RECURRING
  EMERGENCY
  CONSULTATION
}

enum UserRole {
  CLIENT
  ADMIN
  STAFF
  TEAM_MEMBER
  TEAM_LEAD
}


